{% extends "shoppinglist/base.html" %}

{% block content %}

<script type="text/javascript">
// https://stackoverflow.com/a/9186427

function changeAmount(field, delta) {
    var value = parseInt(document.getElementById(field).value, 10);
    value = isNaN(value) ? 0 : value;
    value += delta;
    document.getElementById(field).value = value;
}
</script>

<h1>Alle Produkte</h1>
<form action="{% url 'shoppinglist.views.update_numbers' %}" method="post">
    <div class="container-fluid">
        {% csrf_token %}
        {% for shelf_name, shelf_id, products in shelves %}
        {% if forloop.counter0|divisibleby:"3" %}
        <div class="row">
        {% endif %}
        <div class="shelf col-md-4 col-sm-6">
            <div class="shelf-title">
                <span class="shelf-title">{{ shelf_name }}</span>
                <span class="add-product">
                    <a href="{% url 'shoppinglist.views.add_product' shelf_id %}">+</a>
                </span>
            </div>
            {% if products|length == 0 %}
            <p><em>(keine Produkte)</em></p>
            {% else %}
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th class="name">Produkt</th>
                        <th class="amount">#</th>
                        <th class="change">Δ#</th>
                        <th class="plus">+</th>
                        <th class="minus">−</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr id="product{{ product.id }}"
                        {% if product.desired_amount > 0 %}
                        class="active"
                        {% endif %}
                        >
                        <td class="name">{{ product.name }}</td>
                        <td class="amount">{{ product.desired_amount }}</td>
                        <td class="change">
                            <input class="small" type="number" min="-{{ product.desired_amount }}" value="0" name="id-{{ product.id }}" id="id-{{ product.id }}"/>
                        </td>
                        <td class="plus">
                            <input type="button" onclick="changeAmount('id-{{ product.id }}', 1)" value="+" />
                        </td>
                        <td class="minus">
                            <input type="button" onclick="changeAmount('id-{{ product.id }}', -1)" value="−" />
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        {% if forloop.counter|divisibleby:"3" %}
        </div>
        {% endif %}
        {% endfor %}

        <div class="clearfix visible-md-block"></div>
    </div>

    <div>
        <input type="submit" value="Übernehmen" />
    </div>
</form>

    <form action="{% url 'shoppinglist.views.add_shelf' %}" method="post">
        {% csrf_token %}
        Neues Regal: <input type="text" name="name" /> <input type="submit" value="erstellen" />
    </form>
{% endblock %}
